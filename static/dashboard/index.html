<!DOCTYPE html>
<html lang="cn">

<style type="text/css">
  .disshowalert {
    display: none;
  }

  #box {
    /* width: 500px; */
    height: 300px;
    overflow-x: hidden;
    overflow-y: scroll;
    line-height: 30px;
    text-align: center;
  }

  #box::-webkit-scrollbar {
    display: none;
  }
</style>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../img/favicon.ico">

  <title>Dashboard</title>

  <!-- Bootstrap core CSS -->
  <link href="../dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <link href="../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="dashboard.css" rel="stylesheet">

  <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
  <!--[if lt IE 9]><script src="../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
  <script src="../assets/js/ie-emulation-modes-warning.js"></script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  <link href="../assets/videojs/video-js.css" rel="stylesheet">
  <!-- If you'd like to support IE8 -->
  <script src="../assets/videojs/videojs-ie8.min.js"></script>
  <script src="../assets/videojs/video.js"></script>

</head>

<body>
  <div id="alertdiv">

  </div>


  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
          aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">PizzaHub</a>
      </div>
      <!-- <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#">Dashboard</a></li>
          <li><a href="#">Settings</a></li>
          <li><a href="#">Profile</a></li>
          <li><a href="#">Help</a></li>
        </ul>
        <form class="navbar-form navbar-right">
          <input type="text" class="form-control" placeholder="Search...">
        </form>
      </div> -->
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <!-- <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">.col-xs-6 -->
      <div class="col-sm-5 col-md-6 main">
        <h1 class="page-header">仪表盘</h1>
        <!-- <div class="row placeholders">
            <div style="width: 600px; height: 200px; margin: 0 auto">
              <div id="container-speed" style="width: 300px; height: 200px; float: left"></div>
              <div id="container-rpm" style="width: 300px; height: 200px; float: left"></div>
            </div> -->
        <div class="col-md-6 placeholder">
          <div id="container-speed" style="width: 300px; height: 200px; float: left"></div>
        </div>
        <div class="col-md-6 placeholder">
          <div id="container-rpm" style="width: 300px; height: 200px; float: left"></div>
        </div>
        <!-- <div class="col-md-6 placeholder">
          <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200"
            height="200" class="img-responsive" alt="Generic placeholder thumbnail">
          <h4>Label</h4>
          <span class="text-muted">Something else</span>
        </div>
        <div class="col-md-6 placeholder">
          <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200"
            height="200" class="img-responsive" alt="Generic placeholder thumbnail">
          <h4>Label</h4>
          <span class="text-muted">Something else</span>
        </div> -->
        <!-- <div class="col-md-3 placeholder">
              <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
              <h4>Label</h4>
              <span class="text-muted">Something else</span>
            </div>
            <div class="col-md-3 placeholder">
              <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
              <h4>Label</h4>
              <span class="text-muted">Something else</span>
            </div>
            <div class="col-xs-6 col-sm-3 placeholder">
              <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
              <h4>Label</h4>
              <span class="text-muted">Something else</span>
            </div>
            <div class="col-xs-6 col-sm-3 placeholder">
              <img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
              <h4>Label</h4>
              <span class="text-muted">Something else</span>
            </div> -->


        <h2 class="sub-header">实时数据</h2>
        <!-- 图表容器 DOM -->
        <div class="col-md-12">
          <div id="container"></div>
        </div>
      </div>

      <div class="col-sm-5 col-sm-offset-2 col-md-6 col-md-offset-0 main">
        <h1 class="page-header">实时视频</h1>
        <div style="width: 600px; height: 200px;">
          <div style="width: 600px; height: 200px; margin: 0 auto">
            <video id="my-video" class="video-js" controls preload="auto" width="640" height="300"
              poster="../img/poster.jpg" data-setup="{}">
              <source src="rtmp://121.199.26.171:2018/live/" type="rtmp/flv">
              </p>
            </video>
          </div>
        </div>
        <div style="margin-top: 120px;"></div>
        <h2 class="sub-header">实时数据</h2>
        <div>
          <div id="box">
            <ul class="list-group" id="realtimedata">
              <li class="list-group-item" style="text-align: left;">设备启动</li>
            </ul>
          </div>
        </div>
      </div>

    </div>
  </div>


  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="../assets/js/vendor/jquery.min.js"></script>
  <!-- <script>window.jQuery || document.write('<script src="../assets/js/vendor/jquery.min.js"><\/script>')</script> -->
  <script src="../dist/js/bootstrap.min.js"></script>
  <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
  <script src="../assets/js/vendor/holder.min.js"></script>
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="../assets/js/ie10-viewport-bug-workaround.js"></script>
</body>

<script src="../assets/js/highcharts.js"></script>
<script src="../assets/js/highcharts-more.js"></script>
<script src="../assets/js/solid-gauge.js"></script>
<script src="../assets/js/highcharts-zh_CN.js"></script>
<script src="../assets/js/exporting.js"></script>
<script src="../assets/js/oldie.js"></script>

<script>
  Highcharts.setOptions({
    global: {
      useUTC: false
    }
  });
  // function activeLastPointToolip(chart) {
  //   var points = chart.series[0].points;
  //   chart.tooltip.refresh(points[points.length - 1]);
  //   var points2 = chart.series[1].points;
  //   chart.tooltip.refresh(points2[points2.length - 1]);
  // }


  var chart = Highcharts.chart('container', {
    chart: {
      zoomType: 'xy'
    },
    title: {
      text: '温湿度实时数据'
    },
    xAxis: {
      type: 'datetime',
      title: {
        text: null
      }
    },
    yAxis: [{ // Primary yAxis
      labels: {
        format: '{value}°C',
        style: {
          color: Highcharts.getOptions().colors[1]
        }
      },
      title: {
        text: '温度',
        style: {
          color: Highcharts.getOptions().colors[1]
        }
      }
    }, { // Secondary yAxis
      title: {
        text: '湿度',
        style: {
          color: Highcharts.getOptions().colors[0]
        }
      },
      labels: {
        format: '{value} %',
        style: {
          color: Highcharts.getOptions().colors[0]
        }
      },
      opposite: true
    }],
    tooltip: {
      shared: true
    },
    legend: {
      layout: 'vertical',
      align: 'left',
      x: 120,
      verticalAlign: 'top',
      y: 100,
      floating: true,
      backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'
    },
    series: [{
      name: '湿度',
      type: 'spline',
      yAxis: 1,
      data: [[(new Date()).getTime(), 0], [(new Date()).getTime(), 0], [(new Date()).getTime(), 0], [(new Date()).getTime(), 0]],
      tooltip: {
        valueSuffix: ' %'
      }
    }, {
      name: '温度',
      type: 'spline',
      data: [[(new Date()).getTime(), 0], [(new Date()).getTime(), 0], [(new Date()).getTime(), 0], [(new Date()).getTime(), 0]],
      tooltip: {
        valueSuffix: '°C'
      }
    }]
  });

  // 公共配置
  Highcharts.setOptions({
    chart: {
      type: 'solidgauge'
    },
    title: null,
    pane: {
      center: ['50%', '85%'],
      size: '140%',
      startAngle: -90,
      endAngle: 90,
      background: {
        backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || '#EEE',
        innerRadius: '60%',
        outerRadius: '100%',
        shape: 'arc'
      }
    },
    tooltip: {
      enabled: false
    },
    yAxis: {
      stops: [
        [0.1, '#55BF3B'], // green
        [0.5, '#DDDF0D'], // yellow
        [0.9, '#DF5353'] // red
      ],
      lineWidth: 0,
      minorTickInterval: null,
      tickPixelInterval: 400,
      tickWidth: 0,
      title: {
        y: -70
      },
      labels: {
        y: 16
      }
    },
    plotOptions: {
      solidgauge: {
        dataLabels: {
          y: 5,
          borderWidth: 0,
          useHTML: true
        }
      }
    }
  });
  // 温度仪表
  var chart1 = Highcharts.chart('container-speed', {
    yAxis: {
      min: 0,
      max: 50,
      title: {
        text: '温度'
      }
    },
    credits: {
      enabled: false
    },
    series: [{
      name: '温度',
      data: [20],
      dataLabels: {
        format: '<div style="text-align:center"><span style="font-size:25px;color:' +
          ((Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black') + '">{y:.1f}</span><br/>' +
          '<span style="font-size:12px;color:silver">°C</span></div>'
      },
      tooltip: {
        valueSuffix: ' °C'
      }
    }]
  });
  // 转速仪表
  var chart2 = Highcharts.chart('container-rpm', {
    yAxis: {
      min: 0,
      max: 100,
      title: {
        text: '湿度'
      }
    },
    series: [{
      name: '湿度',
      data: [1],
      dataLabels: {
        format: '<div style="text-align:center"><span style="font-size:25px;color:' +
          ((Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black') + '">{y:.1f}</span><br/>' +
          '<span style="font-size:12px;color:silver">%</span></div>'
      },
      tooltip: {
        valueSuffix: ' revolutions/min'
      }
    }]
  });
  var timepre = "";
  // 定时刷新数据
  setInterval(function () {
    // var point,
    //   newVal,
    //   inc;
    // var x = (new Date()).getTime(); // 当前时间
    // var y1 = Math.random() * 10 + 20;         // 温度
    // var y2 = Math.random() * 100;          // 湿度
    // if (chart) {
    //   var series0 = chart.series[0];
    //   var series1 = chart.series[1];
    //   series0.addPoint([x, y2], true, false);
    //   series1.addPoint([x, y1], true, false);
    //   chart.xAxis[0].setExtremes(x - + 60000, x);
    //   // activeLastPointToolip(chart);
    // }
    // if (chart1) {
    //   point = chart1.series[0].points[0];
    //   point.update(y1);
    // }
    // if (chart2) {
    //   point = chart2.series[0].points[0];
    //   point.update(y2);
    // }

    $.get("http://47.98.169.4:6082/data/webdata", function (result) {
      console.log(result)
      // hum: "33"
      // id: "11"
      // shake: "315154"
      // tem: "22"
      // time: "2020-06-12 23:17:14"
      if (result.time != timepre) {
        timepre = result.time
        if (result.shake == "0") {
          $("#alertdiv").append('<div class="alert alert-danger alert-dismissible" role="alert" style="text-align: center;">     <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button> <strong>警告!</strong> 光照过高。</div>')
        }
        $("#realtimedata").prepend('<li class="list-group-item" style="text-align: left;">'+  result.time + ' -- 温度: ' + result.tem+  ' °C, 湿度: ' + result.hum+    ' %, 震动: '+ result.shake +'</li>')
        

        var x = (new Date(result.time)).getTime(); // 当前时间
        var y1 = parseFloat(result.tem);        // 温度
        var y2 = parseFloat(result.hum);        // 湿度
        var point;
        if (chart) {
          var series0 = chart.series[0];
          var series1 = chart.series[1];
          series0.addPoint([x, y2], true, false);
          series1.addPoint([x, y1], true, false);
          chart.xAxis[0].setExtremes(x - + 60000, x);
          // activeLastPointToolip(chart);
        }
        if (chart1) {
          point = chart1.series[0].points[0];
          point.update(y1);
        }
        if (chart2) {
          point = chart2.series[0].points[0];
          point.update(y2);
        }
      }

    });
  }, 2000);





</script>



</html>
